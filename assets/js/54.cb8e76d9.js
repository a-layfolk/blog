(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{516:function(t,s,a){"use strict";a.r(s);var n=a(25),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"变量、作用域和内存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#变量、作用域和内存"}},[t._v("#")]),t._v(" 变量、作用域和内存")]),t._v(" "),a("h2",{attrs:{id:"基本类型和引用类型的值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本类型和引用类型的值"}},[t._v("#")]),t._v(" 基本类型和引用类型的值")]),t._v(" "),a("p",[t._v("在将一个值赋给变量时，解析器必须确定这个值是基本类型值还是引用类型值。")]),t._v(" "),a("p",[t._v("引用类型的值是保存在内存中的对象。与其他语言不同，JavaScript 不允许直接访问内存中的位置，也就是说"),a("strong",[t._v("不能直接操作对象的内存空间")]),t._v("。在操作对象时，实际上是在"),a("strong",[t._v("操作对象的引用")]),t._v("而不是实际的对象。为此，引用类型的值是按引用访问的。")]),t._v(" "),a("h3",{attrs:{id:"动态的属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态的属性"}},[t._v("#")]),t._v(" 动态的属性")]),t._v(" "),a("p",[t._v("对于引用类型的值，我们可以为其添加属性和方法，也可以改变和删除其属性和方法。")]),t._v(" "),a("p",[t._v("但是，我们不能给基本类型的值添加属性，尽管这样做不会导致任何错误。")]),t._v(" "),a("h3",{attrs:{id:"复制变量值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复制变量值"}},[t._v("#")]),t._v(" 复制变量值")]),t._v(" "),a("p",[t._v("基本类型复制后，基本类型的两个变量之后是完全独立的。")]),t._v(" "),a("p",[t._v("引用类型复制后，它的副本是一个指针，两个变量实际上将引用同一个对象。")]),t._v(" "),a("h3",{attrs:{id:"传递参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#传递参数"}},[t._v("#")]),t._v(" 传递参数")]),t._v(" "),a("p",[t._v("ES 的所有函数的参数都是值传递的。")]),t._v(" "),a("p",[t._v("只不过，引用类型的值传递有些奇特。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Nicholas"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" person "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("person"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("person"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// "Nicholas"')]),t._v("\n")])])]),a("p",[t._v("在函数内部，obj 和 person 引用的是同一个对象。")]),t._v(" "),a("p",[t._v("**即使这个值是按值传递的，obj 也会按引用来访问同一个对象。**于是，挡在函数内部为 obj 添加 name 属性后，函数外部的 person 也将有所反应。")]),t._v(" "),a("p",[a("strong",[t._v("但对象的确是按照值传递的")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Nicholas"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Oreg"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" person "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("person"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("person"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// "Nicholas"')]),t._v("\n")])])]),a("h3",{attrs:{id:"检测类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检测类型"}},[t._v("#")]),t._v(" 检测类型")]),t._v(" "),a("p",[t._v("typeof 可以确定是不是引用类型。")]),t._v(" "),a("p",[t._v("但通常我们想知道，它到底是什么类型的对象，为此我们需要用到 instanceof 操作符。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("person "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 变量 person 是 Object 吗？")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("person "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 变量 colors 是 Array 吗？")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("person "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegExp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 变量 pattern 是 RegExp 吗？")]),t._v("\n")])])]),a("h2",{attrs:{id:"执行环境和作用域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行环境和作用域"}},[t._v("#")]),t._v(" 执行环境和作用域")]),t._v(" "),a("p",[t._v("执行环境定义了变量 或函数有权访问的其他数据，每个执行环境都有一个与之关联的"),a("strong",[t._v("变量对象")]),t._v("。")]),t._v(" "),a("ul",[a("li",[t._v("在 Web 浏览器中，全局执行环境被认为是 window 对象")])]),t._v(" "),a("p",[t._v("每个函数都有自己的执行环境。")]),t._v(" "),a("p",[t._v("当代码在一个环境中执行时，会创建变量对象的一个"),a("strong",[t._v("作用域链")]),t._v("。作用域链的前端，时钟都是当前执行的代码所在环境的变量对象。")]),t._v(" "),a("p",[t._v("如果环境时函数，则活动对象一开始只包含一个变量，即 arguments 对象。它的下一个变量对象来自包含（外部）环境，而在下一个对象则来自下一个包含环境，像这样一直延申到全局执行环境。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" color "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("changeColor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        color "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"red"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        color "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n * changeColor() 的作用域链包含两个对象\n * arguments 对象\n * 全局环境的变量对象，可以访问 color\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("changeColor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Color is new "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" color"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"延长作用域链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#延长作用域链"}},[t._v("#")]),t._v(" 延长作用域链")]),t._v(" "),a("p",[t._v("虽然执行环境的类型总共只有两种——全局和局部（函数），但还是有其他方法来延长作用域链。")]),t._v(" "),a("p",[t._v("有些语句可以在作用域链前端临时增加一个变量对象，该变量对象会在代码执行后被移除。")]),t._v(" "),a("ul",[a("li",[t._v("try-catch 语句的 catch 块")]),t._v(" "),a("li",[t._v("with 语句")])]),t._v(" "),a("h3",{attrs:{id:"没有块级作用域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#没有块级作用域"}},[t._v("#")]),t._v(" 没有块级作用域")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" color "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("如果在 C/C++/Java 中，color 会在 if 执行完毕之后被销毁，但在 JavaScript 中，if 语句中的变量声明会将变量添加到当前的执行环境中。"),a("strong",[t._v("在使用 for 语句时尤其要记住这一差异")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("1. 声明变量")])]),t._v(" "),a("ul",[a("li",[t._v("使用 var 声明的变量会自动被添加到"),a("strong",[t._v("最接近的环境中")]),t._v(" "),a("ul",[a("li",[t._v("在函数内部，最接近的环境就是函数环境")]),t._v(" "),a("li",[t._v("在 with 语句中，最接近的环境就是函数环境")])])]),t._v(" "),a("li",[t._v("如果初始化变量时没有使用 var 声明，该变量会"),a("strong",[t._v("自动被添加到全局变量")])])]),t._v(" "),a("p",[a("strong",[t._v("2. 查询标识符")])]),t._v(" "),a("p",[t._v("在某个环境中，为了读取或写入而引用一个标识符时，必须通过搜索来确定该标识符实际代表什么。搜索过程从作用域链的前端开始，向上逐级查询与给定名字匹配的标识符。")]),t._v(" "),a("h2",{attrs:{id:"垃圾收集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#垃圾收集"}},[t._v("#")]),t._v(" 垃圾收集")]),t._v(" "),a("p",[t._v("JavaScript 具有自动垃圾回收机制，也就是说，执行环境会负责管理代码执行过程中使用的内存。")]),t._v(" "),a("p",[t._v("这种垃圾收集机制的原理就是：找出那些不再继续使用的变量，然后释放其占用的内存。")]),t._v(" "),a("h3",{attrs:{id:"标记清除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#标记清除"}},[t._v("#")]),t._v(" 标记清除")]),t._v(" "),a("p",[t._v("当变量进入环境时，就将变量标记为“进入环境”；")]),t._v(" "),a("p",[t._v("当变量离开环境时，将变量标记为“离开环境”；")]),t._v(" "),a("p",[t._v("垃圾收集器会销毁那些带标记的值并回收它们所占用的内存空间。")]),t._v(" "),a("h3",{attrs:{id:"引用计数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引用计数"}},[t._v("#")]),t._v(" 引用计数")]),t._v(" "),a("p",[t._v("引用计数的含义是跟踪记录每个值被引用的次数。")]),t._v(" "),a("h3",{attrs:{id:"性能问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能问题"}},[t._v("#")]),t._v(" 性能问题")]),t._v(" "),a("p",[t._v("垃圾收集器是周期性运转的，如果为变量分配的内存很可观，那么收集工作量也是相当大的。")]),t._v(" "),a("h3",{attrs:{id:"管理内存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管理内存"}},[t._v("#")]),t._v(" 管理内存")]),t._v(" "),a("p",[t._v("分配给 Web 浏览器的可用内存数量通常要比分配给桌面应用系统的少，这样做的目的主要是防止运行 JavaScript 的网页耗尽全部系统内存而导致系统崩溃。")]),t._v(" "),a("p",[t._v("因此，确保占用最少的内存可以让页面获得更好的性能。优化内存的最佳方法是只保存必要的数据。")]),t._v(" "),a("p",[a("strong",[t._v("解除引用")]),t._v("：一旦数据不再有用，最好将其值设置为 null。这个做法适用于大多数全局变量和全部变量的属性，局部变量会在离开执行环境时自动被解除引用。")])])}),[],!1,null,null,null);s.default=r.exports}}]);