(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{458:function(t,v,_){t.exports=_.p+"assets/img/basic_format_of_TSS.39b9aef9.jpg"},459:function(t,v,_){t.exports=_.p+"assets/img/format_of_gate_descriptor.76c8f142.jpg"},460:function(t,v,_){t.exports=_.p+"assets/img/privilege_level_checking_during_segment_access.4c78a4a5.jpg"},564:function(t,v,_){"use strict";_.r(v);var s=_(25),a=Object(s.a)({},(function(){var t=this,v=t.$createElement,s=t._self._c||v;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"微处理器管理模式-下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微处理器管理模式-下"}},[t._v("#")]),t._v(" 微处理器管理模式（下）")]),t._v(" "),s("h2",{attrs:{id:"任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#任务"}},[t._v("#")]),t._v(" 任务")]),t._v(" "),s("p",[t._v("完成某项共功能的多个程序的集合称为任务，系统中至少存在一个任务。")]),t._v(" "),s("p",[t._v("每个任务都由两部分组成：任务执行环境（Task Executation Space，TES）和任务状态段（Task State Segment，TSS）")]),t._v(" "),s("h3",{attrs:{id:"任务执行环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#任务执行环境"}},[t._v("#")]),t._v(" 任务执行环境")]),t._v(" "),s("p",[t._v("任务执行环境包括一个代码段、堆栈段和数据段等，任务在每一个特权级上执行时，都有一个堆栈段。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("在 Windows、Linux 系统中，没有特权级 1 和 2，因此只有两个堆栈段，内核堆栈段和用户堆栈段在线性地址空间中完全重合，但是用了不同的段描述符。")])]),t._v(" "),s("p",[t._v("每个任务都有一个 LDT 描述符表，构成一个局部地址空间。局部空间的数据和代码不能被其他任务访问。每个 CPU 核有一个 GDT 描述符表，构成一个全局地址空间，所有的任务都可以共享全局地址空间。")]),t._v(" "),s("h3",{attrs:{id:"任务状态段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#任务状态段"}},[t._v("#")]),t._v(" 任务状态段")]),t._v(" "),s("p",[t._v("任务状态段（TSS）中保存了任务的各种状态信息。通过它可以实现任务的挂起和恢复。")]),t._v(" "),s("p",[t._v("任务挂起时，TSS 中把偶从哪里任务现场各寄存器的完成映像；任务恢复时，从 TSS 装入各寄存器的值。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("任务状态段在主存中的位置、大小和属性等信息由任务状态描述符（TSS 描述符描述）。")]),t._v(" "),s("p",[t._v("TSS 描述符属于系统描述符，必须放在 GDT 表中，不能放在 LDT 或 IDT 中。")]),t._v(" "),s("p",[t._v("TSS 描述符的类型位 TYPE 为：1001 或 1011。")]),t._v(" "),s("ul",[s("li",[t._v("如果一个任务是当前正在执行的任务，或者是挂起的任务，那么该任务是“忙”，1011")]),t._v(" "),s("li",[t._v("否则，该任务为 “可用” 任务，1001")])])]),t._v(" "),s("p",[t._v("TSS 的基本格式由 104 字节组成。具体可以看书 59 页。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("图片")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("img",{attrs:{src:_(458),alt:""}})]),t._v(" "),s("td",[t._v("1. 寄存器保存区域位于 TSS 内偏移 20H~5FH 处,用以保存通用寄存器、段寄存器、指令指针和标志寄存器。"),s("br"),t._v("2. 内层堆栈区域是为了保存不同特权级下的堆栈指针。"),s("br"),t._v("3. 地址映射寄存器区域用来保存任务相关寄存器供地址转换使用，如页目录基址寄存器等。"),s("br"),t._v("4. 链接字段位于在 TSS 便宜 0 开始的双字中，其高 16 位未用，而低 16 位保存前一任务的 TSS 的选择符。"),s("br"),t._v("5. I/O 许可位图区域是为了实现输入/输出的保护。")])])])]),t._v(" "),s("h3",{attrs:{id:"门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#门"}},[t._v("#")]),t._v(" 门")]),t._v(" "),s("p",[t._v("门（Gate）可以看作是一种转换机构，可以实现不同特权级别之间的控制传送。")]),t._v(" "),s("p",[t._v("门描述符属于系统描述符，如下图所示：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("图片")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("img",{attrs:{src:_(459),alt:""}})]),t._v(" "),s("td",[t._v("其中 S 位用来区分系统描述符和段描述符。 S = 0 表示系统描述符，S = 1 表示段描述符。"),s("br"),t._v("系统描述符中设置了一个类型（TYPE）字段，4 位可表示 16 种类型，以此来区分各种系统描述符。（具体看书第 60 页）")])])])]),t._v(" "),s("p",[t._v("门的类型有 4 种：调用门、任务门、中断门和陷阱门。")]),t._v(" "),s("p",[s("strong",[t._v("调用门")])]),t._v(" "),s("p",[t._v("系统描述符的类型为 4 或 C 时，表示调用门。调用门可以实现当前任务从低特权级到更高特权级的间接控制转移。它在更高特权级的段中定义了一个入口点，该入口点的虚拟地址（目标选择符和偏移量）包含在调用门中。")]),t._v(" "),s("p",[t._v("调用门可以驻留在 GDT 中，也可以驻留在 LDT 中，但是不可再 IDT 中。")]),t._v(" "),s("p",[t._v("之后的解释我没看明白。")]),t._v(" "),s("p",[s("strong",[t._v("任务门")])]),t._v(" "),s("p",[t._v("任务门指示任务。任务门内的 选择符必须指示 GDT 中的任务状态段 TSS 描述符，门中的偏移量无意义。任务的入口点保存在 TSS 中。利用段间转移指令 JMP 和段间调用指令 CALL，通过任务门可实现任务切换。")]),t._v(" "),s("p",[s("strong",[t._v("中断门和陷阱门")])]),t._v(" "),s("p",[t._v("中断门和陷阱门描述中断/异常处理程序的入口带你。只有在中断描述符表 IDT 中才有效。")]),t._v(" "),s("h3",{attrs:{id:"任务切换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#任务切换"}},[t._v("#")]),t._v(" 任务切换")]),t._v(" "),s("p",[t._v("处理器在以下四种情况时，发生任务切换。")]),t._v(" "),s("ul",[s("li",[t._v("当前的程序、任务、过程执行远程 JMP 或者 CALL 指令，选择了 GDT 中的 TSS 描述符，此时指令中的偏移量忽略。")]),t._v(" "),s("li",[t._v("当前的程序、任务、过程执行远程 JMP 或者 CALL 指令，从 GDT 或者 LDT 中选择了任务门，目标地址的偏移量部分被忽略，新的 TSS 选择符在门中。")]),t._v(" "),s("li",[t._v("发生了中断或异常，中断向量选择了 IDT 中的任务门。新 TSS 选择符在门中。")]),t._v(" "),s("li",[t._v("当 FLAGS 中的 NT = 1 时，执行 IRET 指令，目的任务选择符在执行 IRET 任务的 TSS 链接域中。")])]),t._v(" "),s("p",[t._v("任务切换的方式包括直接任务切换和间接任务切换。")]),t._v(" "),s("h2",{attrs:{id:"保护"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#保护"}},[t._v("#")]),t._v(" 保护")]),t._v(" "),s("p",[t._v("Intel 处理器的保护通过四个特权级区分系统程序和应用程序。")]),t._v(" "),s("h3",{attrs:{id:"数据访问保护"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据访问保护"}},[t._v("#")]),t._v(" 数据访问保护")]),t._v(" "),s("p",[t._v("保护模式下程序要访问某一个段时，都要完成类型、限长和特权级三种形式的检查。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("类型检查")]),t._v(" "),s("p",[t._v("检查段描述符的段类型是否与目标一致，比如可读和可写就不一致。")])]),t._v(" "),s("li",[s("p",[t._v("限长检查")]),t._v(" "),s("p",[t._v("保护模式下段的长度可变，CPU 利用段描述符中给出的限长来防止程序的存储器寻址超出段边界。")])]),t._v(" "),s("li",[s("p",[t._v("其他属性检查")])]),t._v(" "),s("li",[s("p",[t._v("特权级检查")]),t._v(" "),s("p",[t._v("CPU 在加载段选择符入寄存器时，检查特权级，主要包括 CPL、DPL、RPL，它们的含义如下：")]),t._v(" "),s("ul",[s("li",[t._v("CPL （Current Privilege Level）是当前正在运行程序的特权级。CPL 是 CS 段寄存器的最低 2 位。")]),t._v(" "),s("li",[t._v("DPL（Description Privilege Level）是描述符特权级，位于段描述符中。它规定了可以访问此段的最低特权级，只有相同级别或者更高级别的程序才可以访问它。")]),t._v(" "),s("li",[t._v("RPL（Request Privilege Level）是请求特权级，是要赋给段寄存器的 16 位数字的最低两位。它表明了程序“要求”以什么杨的特权级来访问这个段，RPL 一般用来指出一个选择符创建者的特权。如在 “MOV DS, AX” 的例子中，AX 的最低 2 位就是 RPL。如果 RPL > CPL ，那么当前程序就降级来与 RPL 匹配。")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("图片")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("img",{attrs:{src:_(460),alt:""}})]),t._v(" "),s("td",[t._v("在给段寄存器赋值时，CPU 要根据 CPL、DPL、RPL 来检查特权级是否满足要求："),s("br"),s("strong",[t._v("DPL >= MAX(CPL, RPL)")]),s("br"),t._v("**即程序只能访问特权级相同或者较低的数据。**这里 >= 和 MAX 操作都是按照数字的大小来进行的，数字越大，表示特权级越低。")])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("在给 SS 赋值时，除了要满足 DPL >= MAX(CPL, RPL) 的条件之外，还必须满足 RPL = CPL。")])])])])])}),[],!1,null,null,null);v.default=a.exports}}]);