(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{400:function(t,a,s){t.exports=s.p+"assets/img/gcc_version.5f433ad3.jpg"},401:function(t,a,s){t.exports=s.p+"assets/img/gcc_HelloWorld.d217c986.jpg"},402:function(t,a,s){t.exports=s.p+"assets/img/gcc_newHello.e03e08a7.jpg"},403:function(t,a,s){t.exports=s.p+"assets/img/gcc_E.a2ed2942.jpg"},404:function(t,a,s){t.exports=s.p+"assets/img/gcc_fdump_tree.3df66339.jpg"},405:function(t,a,s){t.exports=s.p+"assets/img/gcc_fdump_tree_files.a965078e.jpg"},406:function(t,a,s){t.exports=s.p+"assets/img/gcc_fdump_tree_all_graph.9bda8728.jpg"},407:function(t,a,s){t.exports=s.p+"assets/img/ast.bb948766.jpg"},408:function(t,a,s){t.exports=s.p+"assets/img/gcc_fdump_rtl_all.e4f84995.jpg"},409:function(t,a,s){t.exports=s.p+"assets/img/gcc_fdump_rtl_all_files.a94cdb62.jpg"},410:function(t,a,s){t.exports=s.p+"assets/img/gcc_S.1d6741f0.jpg"},411:function(t,a,s){t.exports=s.p+"assets/img/clang_version.01604f6d.jpg"},412:function(t,a,s){t.exports=s.p+"assets/img/clang_HelloWorld.3d662b3c.jpg"},413:function(t,a,s){t.exports=s.p+"assets/img/clang_newHello.c5bd1f99.jpg"},414:function(t,a,s){t.exports=s.p+"assets/img/clang_ccc_print_phases_Prime_c_c.be780327.jpg"},415:function(t,a,s){t.exports=s.p+"assets/img/clang_Prime_c_Xclang_dump_tokens.b60c5e27.jpg"},416:function(t,a,s){t.exports=s.p+"assets/img/clang_Prime_c_Xclang_dump_raw_tokens.86b9421b.jpg"},417:function(t,a,s){t.exports=s.p+"assets/img/clang_Prime_c_Xclang_ast_dump.70159e44.jpg"},418:function(t,a,s){t.exports=s.p+"assets/img/clang_prime_c_Xclang_ast_view.7405eb41.jpg"},419:function(t,a,s){t.exports=s.p+"assets/img/clang_Prime_c_S_mllvm_print_after_all.08db234a.jpg"},420:function(t,a,s){t.exports=s.p+"assets/img/clang_Prime_c_S_mllvm_print_after_all_files.e8685320.jpg"},421:function(t,a,s){t.exports=s.p+"assets/img/clang_Prime_c_S.2bcc0176.jpg"},422:function(t,a,s){t.exports=s.p+"assets/img/vim_b.3e0bd273.jpg"},423:function(t,a,s){t.exports=s.p+"assets/img/gcc_O0.58b6c644.jpg"},424:function(t,a,s){t.exports=s.p+"assets/img/gcc_O1.874ecfdf.jpg"},425:function(t,a,s){t.exports=s.p+"assets/img/gcc_O2.dd63ad58.jpg"},426:function(t,a,s){t.exports=s.p+"assets/img/gcc_O3.5e05ee1b.jpg"},427:function(t,a,s){t.exports=s.p+"assets/img/GCC_O0_O3.3b83b042.jpg"},428:function(t,a,s){t.exports=s.p+"assets/img/clang_O0.3b0d2c58.jpg"},429:function(t,a,s){t.exports=s.p+"assets/img/clang_O1.0bf3fc18.jpg"},430:function(t,a,s){t.exports=s.p+"assets/img/clang_O2.3a2a19fb.jpg"},431:function(t,a,s){t.exports=s.p+"assets/img/clang_O3.537c46e9.jpg"},432:function(t,a,s){t.exports=s.p+"assets/img/CLANG_O0_O3.c603c5e8.jpg"},433:function(t,a,s){t.exports=s.p+"assets/img/GCC_LLVM_O0_O3.4da49086.jpg"},497:function(t,a,s){"use strict";s.r(a);var e=s(25),l=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"lab-2-编译器认知实验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lab-2-编译器认知实验"}},[t._v("#")]),t._v(" Lab 2. 编译器认知实验")]),t._v(" "),e("h2",{attrs:{id:"_1-实验目的和内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-实验目的和内容"}},[t._v("#")]),t._v(" 1. 实验目的和内容")]),t._v(" "),e("p",[e("strong",[t._v("实验目的：")])]),t._v(" "),e("ul",[e("li",[t._v("了解工业界常用的编译器 GCC 和 LLVM")]),t._v(" "),e("li",[t._v("熟悉编译器的安装和使用过程")]),t._v(" "),e("li",[t._v("了解编译器工作过程中生成的中间文件格式和内容")]),t._v(" "),e("li",[t._v("了解编译器的优化效果")])]),t._v(" "),e("p",[e("strong",[t._v("实验内容：")])]),t._v(" "),e("ul",[e("li",[t._v("在 Linux 平台上安装和运行编译器 GCC 和 LLVM")]),t._v(" "),e("li",[t._v("编写简单的测试程序，使用编译器编译")]),t._v(" "),e("li",[t._v("观察中间输出结果")])]),t._v(" "),e("h2",{attrs:{id:"_2-实验的具体过程和步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-实验的具体过程和步骤"}},[t._v("#")]),t._v(" 2. 实验的具体过程和步骤")]),t._v(" "),e("p",[e("strong",[t._v("实验具体过程：")])]),t._v(" "),e("p",[t._v("首先编写简单的代码作为测试用例，熟悉 GCC 和 Clang 的基本编译命令。之后使用计卫星老师 GitHub 中的 C 语言代码作为测试用例。在 Ubuntu 20.04 下对这些测试用例进行编译，每完成一个步骤，记录指令和结果。这部分内容主要记录在 “2. 实验的具体过程和步骤”。")]),t._v(" "),e("p",[t._v("接着使用相同的代码，通过 GCC 和 LLVM 分别对测试代码进行 O0、O1、O2、O3 优化，并对比分析。这部分内容主要记录在 “5. GCC 与 LLVM 对比分析”。")]),t._v(" "),e("p",[e("strong",[t._v("实验具体步骤：")])]),t._v(" "),e("ul",[e("li",[t._v("对于 GCC 编译器：\n"),e("ul",[e("li",[t._v("查看编译器的版本")]),t._v(" "),e("li",[t._v("使用编译器编译单个文件")]),t._v(" "),e("li",[t._v("使用编译器编译链接多个文件")]),t._v(" "),e("li",[t._v("查看预处理结果")]),t._v(" "),e("li",[t._v("查看语法分析树")]),t._v(" "),e("li",[t._v("查看中间代码生成结果")]),t._v(" "),e("li",[t._v("查看生成的目标代码（汇编代码）")])])]),t._v(" "),e("li",[t._v("对于 LLVM 编译器\n"),e("ul",[e("li",[t._v("查看编译器的版本")]),t._v(" "),e("li",[t._v("使用编译器编译链接多个文件")]),t._v(" "),e("li",[t._v("查看编译流程和阶段")]),t._v(" "),e("li",[t._v("查看词法分析结果 1")]),t._v(" "),e("li",[t._v("查看词法分析结果 2")]),t._v(" "),e("li",[t._v("查看语义分析结果 1")]),t._v(" "),e("li",[t._v("查看语义分析结果 2")]),t._v(" "),e("li",[t._v("查看编译优化的结果")]),t._v(" "),e("li",[t._v("查看生成的目标代码结果")])])])]),t._v(" "),e("h3",{attrs:{id:"_2-1-对于-gcc-编译器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-对于-gcc-编译器"}},[t._v("#")]),t._v(" 2.1 对于 GCC 编译器")]),t._v(" "),e("h4",{attrs:{id:"_2-1-1-查看编译器的版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-查看编译器的版本"}},[t._v("#")]),t._v(" 2.1.1 查看编译器的版本")]),t._v(" "),e("p",[t._v("在 Ubuntu 20.04 的控制台中输入：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -v\n")])])]),e("p",[t._v("得到结果：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(400),alt:""}})]),t._v(" "),e("p",[t._v("得知 GCC 编译器的版本为 9.3.0")]),t._v(" "),e("h4",{attrs:{id:"_2-1-2-使用编译器编译单个文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-使用编译器编译单个文件"}},[t._v("#")]),t._v(" 2.1.2 使用编译器编译单个文件")]),t._v(" "),e("p",[t._v("这里编译一个最简单的 HelloWorld.cpp 程序：")]),t._v(" "),e("div",{staticClass:"language-c++ extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('#include <stdio.h>\n\nint main(void) {\n  printf("Hello World!\\n");\n  return 0;\n}\n')])])]),e("p",[t._v("输入 GCC 命令，编译单个文件 HelloWorld.cpp 得到一个 HelloWorld 文件：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc HelloWorld.cpp -o HelloWorld\n")])])]),e("p",[t._v("得到结果：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(401),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-1-3-使用编译器编译链接多个文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-使用编译器编译链接多个文件"}},[t._v("#")]),t._v(" 2.1.3 使用编译器编译链接多个文件")]),t._v(" "),e("p",[t._v("编写 3 个文件，分别是 main.cpp、hello.h、hello.c：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("main.cpp")]),t._v(" "),e("div",{staticClass:"language-c++ extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('#include <stdio.h>\n#include "hello.h"\n\nint main(void) {\n  hello("Hello, World!\\n");\n  return 0;\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("hello.h")]),t._v(" "),e("div",{staticClass:"language-c++ extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("void hello(const char* str);\n")])])])]),t._v(" "),e("li",[e("p",[t._v("hello.cpp")]),t._v(" "),e("div",{staticClass:"language-c++ extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('#include <stdio.h>\n#include "hello.h"\n\nvoid hello(const char* str) {\n  printf("%s", str);\n}\n')])])])])]),t._v(" "),e("p",[t._v("输入 GCC 命令，编译链接多个文件：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -Wall main.cpp hello.cpp -o newHello\n")])])]),e("p",[t._v("得到结果：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(402),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-1-4-查看预处理结果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-查看预处理结果"}},[t._v("#")]),t._v(" 2.1.4 查看预处理结果")]),t._v(" "),e("p",[t._v("编写一个带宏定义的 hi.cpp 文件：")]),t._v(" "),e("div",{staticClass:"language-c++ extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('#include <stdio.h>\n#define STR "this is a string"\n\nint main(void)  {\n  printf(STR);\n  return 0;\n}\n')])])]),e("p",[t._v("输入 GCC 命令，在预处理阶段将 .h 和 .c 展开形成一个文件：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -E hi.cpp -o hi.i\n")])])]),e("p",[t._v("打开 hi.i 文件，可以看到宏定义 STR 已经被替换：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(403),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-1-5-查看语法分析树"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-查看语法分析树"}},[t._v("#")]),t._v(" 2.1.5 查看语法分析树")]),t._v(" "),e("blockquote",[e("p",[t._v("实验在这一步骤之后，我的 Ubuntu 出了问题，所以重装了 Ubuntu 系统，因此之后的图片与此前的图片会有些不同。")])]),t._v(" "),e("p",[t._v("按照实验手册输入 GCC 命令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -fdump-tree-all hi.cpp\n")])])]),e("p",[t._v("结果出现了许多文件，我尝试打开了一些文件，目前还看不出来这些文件是什么意思。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("产生的文件")]),t._v(" "),e("th",[t._v("打开这些文件")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("img",{attrs:{src:s(404),alt:""}})]),t._v(" "),e("td",[e("img",{attrs:{src:s(405),alt:""}})])])])]),t._v(" "),e("p",[t._v("按照我的理解，语法分析图应该是以图片的方式展示，于是我在 "),e("a",{attrs:{href:"https://stackoverflow.com/questions/15800230/how-can-i-dump-an-abstract-syntax-tree-generated-by-gcc-into-a-dot-file",target:"_blank",rel:"noopener noreferrer"}},[t._v("StackOverFlow"),e("OutboundLink")],1),t._v(" 上找到了用 GCC 命令生成语法分析图的方法。")]),t._v(" "),e("p",[t._v("输入 GCC 命令如下：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -fdump-tree-all-graph hi.cpp -o hi\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下面的命令需要安装 graphviz 包才能够执行")]),t._v("\n$ dot -Tpng hi.cpp.012t.cfg.dot -o hi.png\n")])])]),e("p",[t._v("同样出现了许多文件，这些文件我目前也看不懂是什么意思。此外，还生成了一张 png 图片，这就是语法分析图。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("产生的文件")]),t._v(" "),e("th",[t._v("语法分析图")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("img",{attrs:{src:s(406),alt:""}})]),t._v(" "),e("td",[e("img",{attrs:{src:s(407),alt:""}})])])])]),t._v(" "),e("h4",{attrs:{id:"_2-1-6-查看中间代码生成结果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-6-查看中间代码生成结果"}},[t._v("#")]),t._v(" 2.1.6 查看中间代码生成结果")]),t._v(" "),e("blockquote",[e("p",[t._v("此处使用的代码，来自计卫星老师的 GitHub 中的 "),e("a",{attrs:{href:"https://github.com/jiweixing/BIT-MiniCC/blob/master/test/nc_tests/0_BubbleSort.c",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v("0_BubbleSort")]),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("按照实验手册输入 GCC 命令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -fdump-rtl-all BubbleSort.c\n")])])]),e("p",[t._v("同样生成了许多目前我看不懂的文件：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("产生的文件")]),t._v(" "),e("th",[t._v("打开这些文件")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("img",{attrs:{src:s(408),alt:""}})]),t._v(" "),e("td",[e("img",{attrs:{src:s(409),alt:""}})])])])]),t._v(" "),e("h4",{attrs:{id:"_2-1-7-查看生成的目标代码-汇编代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-7-查看生成的目标代码-汇编代码"}},[t._v("#")]),t._v(" 2.1.7 查看生成的目标代码（汇编代码）")]),t._v(" "),e("blockquote",[e("p",[t._v("此处使用的代码，来自计卫星老师  GitHub 中的 "),e("a",{attrs:{href:"https://github.com/jiweixing/BIT-MiniCC/blob/master/test/nc_tests/1_Fibonacci.c",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v("1_Fibonacci.c")]),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("GCC 命令如下：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -S Fibonacci.c -o Fibonacci.s\n")])])]),e("p",[t._v("可以看到已经生成了汇编代码。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(410),alt:""}})]),t._v(" "),e("h3",{attrs:{id:"_2-2-对于-llvm-编译器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-对于-llvm-编译器"}},[t._v("#")]),t._v(" 2.2 对于 LLVM 编译器")]),t._v(" "),e("h4",{attrs:{id:"_2-2-1-查看编译器的版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-查看编译器的版本"}},[t._v("#")]),t._v(" 2.2.1 查看编译器的版本")]),t._v(" "),e("p",[t._v("首先安装 LLVM 和 Clang，LLVM 是编译器的后端，Clang 是编译器的前端。")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" llvm\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" clang\n")])])]),e("p",[t._v("查看 LLVM 和 Clang 的版本，输入命令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang --version\n")])])]),e("p",[t._v("结果如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(411),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-2-2-使用编译器编译单个文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-使用编译器编译单个文件"}},[t._v("#")]),t._v(" 2.2.2 使用编译器编译单个文件")]),t._v(" "),e("p",[t._v("使用的程序文件 HelloWorld.cpp 和 2.1.2 中一样。输入 Clang 指令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang HelloWorld.cpp -o HelloWorld\n")])])]),e("p",[t._v("得到结果：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(412),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-2-3-使用编译器链接多个文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-使用编译器链接多个文件"}},[t._v("#")]),t._v(" 2.2.3 使用编译器链接多个文件")]),t._v(" "),e("p",[t._v("使用的程序文件 main.cpp、hello.h、hello.cpp 和 2.1.3 中一样，输入 Clang 指令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang main.cpp hello.cpp -o newHello\n")])])]),e("p",[t._v("结果如下:")]),t._v(" "),e("p",[e("img",{attrs:{src:s(413),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-2-4-查看编译流程和阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-查看编译流程和阶段"}},[t._v("#")]),t._v(" 2.2.4 查看编译流程和阶段")]),t._v(" "),e("blockquote",[e("p",[t._v("此处使用的代码，来自计卫星老师 GitHub 的 "),e("a",{attrs:{href:"https://github.com/jiweixing/BIT-MiniCC/blob/master/test/nc_tests/2_Prime.c",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v("2_Prime.c")]),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("输入 Clang 指令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang -ccc-print-phases Prime.c -c\n")])])]),e("p",[t._v("结果如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(414),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-2-5-查看词法分析结果-1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-查看词法分析结果-1"}},[t._v("#")]),t._v(" 2.2.5 查看词法分析结果 1")]),t._v(" "),e("blockquote",[e("p",[t._v("此处使用的代码，来自计卫星老师 GitHub 的 "),e("a",{attrs:{href:"https://github.com/jiweixing/BIT-MiniCC/blob/master/test/nc_tests/2_Prime.c",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v("2_Prime.c")]),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("输入 Clang 指令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang Prime.c -Xclang -dump-tokens\n")])])]),e("p",[t._v("结果可以看出正在一个字符接一个字符地进行词法分析，不解析空格：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(415),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-2-6-查看词法分析结果-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-6-查看词法分析结果-2"}},[t._v("#")]),t._v(" 2.2.6 查看词法分析结果 2")]),t._v(" "),e("blockquote",[e("p",[t._v("此处使用的代码，来自计卫星老师 GitHub 的 "),e("a",{attrs:{href:"https://github.com/jiweixing/BIT-MiniCC/blob/master/test/nc_tests/2_Prime.c",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v("2_Prime.c")]),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("输入 Clang 指令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang Prime.c -Xclang -dump-raw-tokens\n")])])]),e("p",[t._v("结果和词法分析结果 1 不同，词法分析结果 2 解析了空格，unknown ' ' 即为佐证。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(416),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-2-7-查看语义分析结果-1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-7-查看语义分析结果-1"}},[t._v("#")]),t._v(" 2.2.7 查看语义分析结果 1")]),t._v(" "),e("blockquote",[e("p",[t._v("此处使用的代码，来自计卫星老师 GitHub 的 "),e("a",{attrs:{href:"https://github.com/jiweixing/BIT-MiniCC/blob/master/test/nc_tests/2_Prime.c",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v("2_Prime.c")]),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("输入 Clang 指令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang Prime.c -Xclang -ast-dump\n")])])]),e("p",[t._v("结果可以看到：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(417),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-2-8-查看语义分析结果-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-8-查看语义分析结果-2"}},[t._v("#")]),t._v(" 2.2.8 查看语义分析结果 2")]),t._v(" "),e("blockquote",[e("p",[t._v("此处使用的代码，来自计卫星老师 GitHub 的 "),e("a",{attrs:{href:"https://github.com/jiweixing/BIT-MiniCC/blob/master/test/nc_tests/2_Prime.c",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v("2_Prime.c")]),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("输入 Clang 指令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang Prime.c -Xclang -ast-view\n")])])]),e("p",[t._v("结果可以看到：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(418),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-2-9-查看编译优化的结果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-9-查看编译优化的结果"}},[t._v("#")]),t._v(" 2.2.9 查看编译优化的结果")]),t._v(" "),e("blockquote",[e("p",[t._v("此处使用的代码，来自计卫星老师 GitHub 的 "),e("a",{attrs:{href:"https://github.com/jiweixing/BIT-MiniCC/blob/master/test/nc_tests/2_Prime.c",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v("2_Prime.c")]),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("输入 Clang 指令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang Prime.c -S -mllvm -print-after-all\n")])])]),e("p",[t._v("结果生成了一个 Prime.s 文件：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("控制台输出")]),t._v(" "),e("th",[t._v("Prime.s 文件")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("img",{attrs:{src:s(419),alt:""}})]),t._v(" "),e("td",[e("img",{attrs:{src:s(420),alt:""}})])])])]),t._v(" "),e("h4",{attrs:{id:"_2-2-10-查看生成的目标代码结果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-10-查看生成的目标代码结果"}},[t._v("#")]),t._v(" 2.2.10 查看生成的目标代码结果")]),t._v(" "),e("blockquote",[e("p",[t._v("此处使用的代码，来自计卫星老师 GitHub 的 "),e("a",{attrs:{href:"https://github.com/jiweixing/BIT-MiniCC/blob/master/test/nc_tests/2_Prime.c",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v("2_Prime.c")]),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("输入 Clang 指令：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang Prime.c –S\n")])])]),e("p",[t._v("结果直接生成了汇编代码文件 Prime.s")]),t._v(" "),e("p",[e("img",{attrs:{src:s(421),alt:""}})]),t._v(" "),e("h2",{attrs:{id:"_3-gcc-运行结果分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-gcc-运行结果分析"}},[t._v("#")]),t._v(" 3. GCC 运行结果分析")]),t._v(" "),e("p",[t._v("GCC 的编译流程分为了四个步骤，分别是：（下述命令以 hello.c 为例子）")]),t._v(" "),e("p",[t._v("**预处理：**把 include 的文件拷贝到要编译的源文件中，在调用宏的地方进行宏替换。")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -E hello.c -o hello.i\n")])])]),e("p",[t._v("具体如何进行宏替换可以看 2.1.4 的截图。")]),t._v(" "),e("p",[t._v("**编译：**将预处理好的代码转换成汇编语言，进行语义语法分析，如果有错则报错。")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -S hello.i -o hello.s\n")])])]),e("p",[t._v("具体生成的汇编语言如何，可以看 2.1.7 的截图。")]),t._v(" "),e("p",[t._v("**汇编：**把汇编语言代码转换为目标代码（一定格式的机器代码）。")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -c hello.s -o hello.o\n")])])]),e("p",[t._v("将 hello.o 以二进制打开再转换为十六进制，效果应该与此图片相似：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(422),alt:""}})]),t._v(" "),e("p",[t._v("**链接：**将生成的 OBJ 文件和系统库的 OBJ 文件链接起来，最终生成可执行文件。")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ gcc -o hello.o -o hello\n")])])]),e("h2",{attrs:{id:"_4-llvm-运行结果分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-llvm-运行结果分析"}},[t._v("#")]),t._v(" 4. LLVM 运行结果分析")]),t._v(" "),e("p",[t._v("LLVM 的编译过程分为七个步骤，分别是：")]),t._v(" "),e("p",[e("strong",[t._v("预处理：")]),t._v(" 执行后可以看到头文件导入以及宏被替换")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang -E main.m -o main_precompile.i\n")])])]),e("p",[t._v("**词法分析：**词法分析会把代码切片成一个个 token")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang -fmodules -E -Xclang -dump-tokens main.m\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或")]),t._v("\n$ clang -fmodules -E -Xclang -dump-tokens main.m "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" main_precompile.i\n")])])]),e("p",[t._v("**语法分析：**以语法树的结构说明待编译文件的目录，比如会说明 main 函数的开始结束行，会说明自动释放池参数、字符串变量、调用函数的行号等信息。")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang -fmodules -fsyntax-only -Xclang -ast-dump main.m\n")])])]),e("p",[e("strong",[t._v("生成中间代码：")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang -S -fobjc-arc -emit-llvm main.m -o main.ll\n")])])]),e("p",[e("strong",[t._v("生成汇编：")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang -S main.m -o main_compile.s\n")])])]),e("p",[e("strong",[t._v("生成目标文件：")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ clang -fmodules -c main.m -o main_obj.o\n")])])]),e("h2",{attrs:{id:"_5-gcc-与-llvm-对比分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-gcc-与-llvm-对比分析"}},[t._v("#")]),t._v(" 5. GCC 与 LLVM 对比分析")]),t._v(" "),e("p",[t._v("编写的测试代码如下，此代码是一个递归求值的斐波那契数列。")]),t._v(" "),e("div",{staticClass:"language-c++ extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('#include <stdio.h>\n\nint fibonacci(int num){\n  int res;\n  if(num < 1){\n    res = 0;\n  } else if (num <= 2){\n    res = 1;\n  } else {\n    res = fibonacci(num-1)+fibonacci(num-2);\n  }\n  return res;\n}\nint main(void){\n  int n = 40;\n  int res = fibonacci(n);\n  printf("%d", res);\n  return 0;\n}\n')])])]),e("h3",{attrs:{id:"_5-1-gcc-的-o0-到-o3-优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-gcc-的-o0-到-o3-优化"}},[t._v("#")]),t._v(" 5.1  GCC 的 O0 到 O3 优化")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("优化类型")]),t._v(" "),e("th",[t._v("用户时间 / s")]),t._v(" "),e("th",[t._v("图片")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("O0")]),t._v(" "),e("td",[t._v("0.353")]),t._v(" "),e("td",[e("img",{attrs:{src:s(423),alt:""}})])]),t._v(" "),e("tr",[e("td",[t._v("O")]),t._v(" "),e("td",[t._v("0.341")]),t._v(" "),e("td",[e("img",{attrs:{src:s(424),alt:""}})])]),t._v(" "),e("tr",[e("td",[t._v("O2")]),t._v(" "),e("td",[t._v("0.165")]),t._v(" "),e("td",[e("img",{attrs:{src:s(425),alt:""}})])]),t._v(" "),e("tr",[e("td",[t._v("O3")]),t._v(" "),e("td",[t._v("0.167")]),t._v(" "),e("td",[e("img",{attrs:{src:s(426),alt:""}})])])])]),t._v(" "),e("p",[t._v("测试结果作图如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(427),alt:""}})]),t._v(" "),e("p",[t._v("从 O0 到 O3 优化，整体来看 GCC 效率是变得更高了，但优化并不代表效率一定会变高。")]),t._v(" "),e("h3",{attrs:{id:"_5-2-llvm-的-o0-到-o3-优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-llvm-的-o0-到-o3-优化"}},[t._v("#")]),t._v(" 5.2 LLVM 的 O0 到 O3 优化")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("优化类型")]),t._v(" "),e("th",[t._v("用户时间 / s")]),t._v(" "),e("th",[t._v("图片")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("O0")]),t._v(" "),e("td",[t._v("0.376")]),t._v(" "),e("td",[e("img",{attrs:{src:s(428),alt:""}})])]),t._v(" "),e("tr",[e("td",[t._v("O1")]),t._v(" "),e("td",[t._v("0.376")]),t._v(" "),e("td",[e("img",{attrs:{src:s(429),alt:""}})])]),t._v(" "),e("tr",[e("td",[t._v("O2")]),t._v(" "),e("td",[t._v("0.371")]),t._v(" "),e("td",[e("img",{attrs:{src:s(430),alt:""}})])]),t._v(" "),e("tr",[e("td",[t._v("O3")]),t._v(" "),e("td",[t._v("0.302")]),t._v(" "),e("td",[e("img",{attrs:{src:s(431),alt:""}})])])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(432),alt:""}})]),t._v(" "),e("p",[t._v("从 O0 到 O3 优化，整体来看 LLVM 效率是变得更高了，但优化并不代表效率一定会变高。")]),t._v(" "),e("h3",{attrs:{id:"_5-3-gcc-和-llvm-对比"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-gcc-和-llvm-对比"}},[t._v("#")]),t._v(" 5.3 GCC 和 LLVM 对比")]),t._v(" "),e("p",[e("img",{attrs:{src:s(433),alt:""}})]),t._v(" "),e("p",[t._v("虽然我查阅到的资料大多说：LLVM 的速度更快，出错信息可读性更好，代码结构更清晰。但就此测试程序编译优化而言，GCC 编译后的文件执行速度的确比 LLVM 编译后的文件执行速度快。")]),t._v(" "),e("h2",{attrs:{id:"_6-实验心得体会"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-实验心得体会"}},[t._v("#")]),t._v(" 6. 实验心得体会")]),t._v(" "),e("p",[t._v("本次实验，我了解了很多和编译器有关的知识，同时也深深地感到自己的不足。虽然自己第一门掌握的语言就是 C 语言，但在做实验过程中才发现自己对 C/C++ 有很多不了解的地方。")]),t._v(" "),e("p",[t._v("同时，我对一些结论的适用性也有了了解，比如 LLVM 出的代码比 GCC 编译出的代码运行速度更快便是不一定的。")]),t._v(" "),e("p",[t._v("此外，虽然我打开过词法分析和语法分析产生的文件，但也只能模糊地有所了解，离明白还有很长的一段距离。")])])}),[],!1,null,null,null);a.default=l.exports}}]);